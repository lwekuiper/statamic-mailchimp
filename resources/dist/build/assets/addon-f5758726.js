const v={methods:{actionStarted(){this.loading=!0},actionCompleted(t=null,e={}){this.loading=!1,t!==!1&&(this.$events.$emit("clear-selections"),this.$events.$emit("reset-action-modals"),e.success===!1?this.$toast.error(e.message||__("Action failed")):this.$toast.success(e.message||__("Action completed")),this.afterActionSuccessfullyCompleted())},afterActionSuccessfullyCompleted(){this.request()}}},y={data(){return{activeFilterBadges:{},activeFilters:{},activePreset:null,activePresetPayload:{},searchQuery:""}},computed:{activeFilterCount(){let t=Object.keys(this.activeFilters).length;return this.activeFilters.hasOwnProperty("fields")&&(t=t+Object.keys(this.activeFilters.fields).filter(e=>e!="badge").length-1),t},canSave(){return this.isDirty&&this.preferencesPrefix},isDirty(){return this.isFiltering?this.activePreset?this.activePresetPayload.query!=this.searchQuery||!_.isEqual(this.activePresetPayload.filters||{},this.activeFilters):!0:!1},isFiltering(){return!_.isEmpty(this.activeFilters)||this.searchQuery||this.activePreset},hasActiveFilters(){return this.activeFilterCount>0},searchPlaceholder(){return this.activePreset?`${__("Searching in:")} ${this.activePresetPayload.display}`:__("Search")}},methods:{searchChanged(t){this.searchQuery=t},hasFields(t){for(const e in t)if(t[e])return!0;return!1},filterChanged({handle:t,values:e},s=!0){e&&this.hasFields(e)?Vue.set(this.activeFilters,t,e):Vue.delete(this.activeFilters,t),s&&this.unselectAllItems()},filtersChanged(t){this.activeFilters={};for(const e in t){const s=t[e];this.filterChanged({handle:e,values:s},!1)}this.unselectAllItems()},filtersReset(){this.activePreset=null,this.activePresetPayload={},this.searchQuery="",this.activeFilters={},this.activeFilterBadges={}},unselectAllItems(){this.$refs.dataList&&this.$refs.dataList.clearSelections()},selectPreset(t,e){this.activePreset=t,this.activePresetPayload=e,this.searchQuery=e.query,this.filtersChanged(e.filters)},autoApplyFilters(t){if(!t)return;let e={};t.filter(s=>!_.isEmpty(s.auto_apply)).forEach(s=>{e[s.handle]=s.auto_apply}),this.activeFilters=e}}},$={props:{initialPerPage:{type:Number,default(){return Statamic.$config.get("paginationSize")}}},data(){return{perPage:this.initialPerPage,page:1}},mounted(){this.setInitialPerPage()},methods:{setInitialPerPage(){this.hasPreferences&&(this.perPage=this.getPreference("per_page")||this.initialPerPage)},changePerPage(t){t=parseInt(t),(this.hasPreferences?this.setPreference("per_page",t!=this.initialPerPage?t:null):Promise.resolve()).then(s=>{this.perPage=t,this.resetPage()})},selectPage(t){this.page=t,this.$events.$emit("clear-selections")},resetPage(){this.page=1,this.$events.$emit("clear-selections")}}},P={data(){return{preferencesPrefix:null}},computed:{hasPreferences(){return this.preferencesPrefix!==null}},methods:{preferencesKey(t){return`${this.preferencesPrefix}.${t}`},getPreference(t){return this.$preferences.get(this.preferencesKey(t))},setPreference(t,e){return this.$preferences.set(this.preferencesKey(t),e)},removePreference(t,e=null){return this.$preferences.remove(this.preferencesKey(t),e)}}};function o(t,e,s,i,n,c,h,f){var r=typeof t=="function"?t.options:t;e&&(r.render=e,r.staticRenderFns=s,r._compiled=!0),i&&(r.functional=!0),c&&(r._scopeId="data-v-"+c);var l;if(h?(l=function(a){a=a||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,!a&&typeof __VUE_SSR_CONTEXT__<"u"&&(a=__VUE_SSR_CONTEXT__),n&&n.call(this,a),a&&a._registeredComponents&&a._registeredComponents.add(h)},r._ssrRegister=l):n&&(l=f?function(){n.call(this,(r.functional?this.parent:this).$root.$options.shadowRoot)}:n),l)if(r.functional){r._injectStyles=l;var m=r.render;r.render=function(g,d){return l.call(d),m(g,d)}}else{var u=r.beforeCreate;r.beforeCreate=u?[].concat(u,l):[l]}return{exports:t,options:r}}const C={mixins:[v,y,$,P],props:{initialSortColumn:String,initialSortDirection:String,initialColumns:{type:Array,default:()=>[]},filters:Array,actionUrl:String},data(){return{source:null,initializing:!0,loading:!0,items:[],columns:this.initialColumns,visibleColumns:this.initialColumns.filter(t=>t.visible),sortColumn:this.initialSortColumn,sortDirection:this.initialSortDirection,meta:null,pushQuery:!1,popping:!1}},computed:{parameterMap(){return{sort:"sortColumn",order:"sortDirection",page:"page",perPage:"perPage",search:"searchQuery",filters:"activeFilterParameters",columns:"visibleColumnParameters"}},parameters:{get(){return{...Object.fromEntries(Object.entries(this.parameterMap).map(([e,s])=>[e,this[s]]).filter(([e,s])=>s!=null&&s!=="")),...this.additionalParameters}},set(t){Object.entries(this.parameterMap).forEach(([e,s])=>{t.hasOwnProperty(e)&&(this[s]=t[e])})}},activeFilterParameters:{get(){return _.isEmpty(this.activeFilters)?null:utf8btoa(JSON.stringify(this.activeFilters))},set(t){this.activeFilters=JSON.parse(utf8atob(t))}},visibleColumnParameters:{get(){return _.isEmpty(this.visibleColumns)?null:this.visibleColumns.map(t=>t.field).join(",")},set(t){this.visibleColumns=t.split(",").map(e=>this.columns.find(s=>s.field===e))}},additionalParameters(){return{}},shouldRequestFirstPage(){return this.page>1&&this.items.length===0?(this.page=1,!0):!1}},created(){this.autoApplyFilters(this.filters),this.autoApplyState(),this.request()},mounted(){this.pushQuery&&(window.history.replaceState({parameters:this.parameters},""),window.addEventListener("popstate",this.popState))},beforeDestroy(){this.pushQuery&&window.removeEventListener("popstate",this.popState)},watch:{parameters:{deep:!0,handler(t,e){e.search===t.search&&JSON.stringify(e)!==JSON.stringify(t)&&(this.request(),this.pushState())}},loading:{immediate:!0,handler(t){this.$progress.loading(this.listingKey,t)}},searchQuery(t){this.sortColumn=null,this.sortDirection=null,this.resetPage(),this.request(),this.pushState()}},methods:{request(){if(!this.requestUrl){this.loading=!1;return}this.loading=!0,this.source&&this.source.cancel(),this.source=this.$axios.CancelToken.source(),this.$axios.get(this.requestUrl,{params:this.parameters,cancelToken:this.source.token}).then(t=>{if(this.columns=t.data.meta.columns,this.activeFilterBadges={...t.data.meta.activeFilterBadges},this.items=Object.values(t.data.data),this.meta=t.data.meta,this.shouldRequestFirstPage)return this.request();this.loading=!1,this.initializing=!1,this.afterRequestCompleted(t)}).catch(t=>{this.$axios.isCancel(t)||(this.loading=!1,this.initializing=!1,!(t.request&&!t.response)&&this.$toast.error(t.response?t.response.data.message:__("Something went wrong"),{duration:null}))})},afterRequestCompleted(t){},sorted(t,e){this.sortColumn=t,this.sortDirection=e},removeRow(t){let e=t.id,s=_.indexOf(this.rows,_.findWhere(this.rows,{id:e}));this.rows.splice(s,1),this.rows.length===0&&location.reload()},popState(t){!this.pushQuery||!t.state||(this.popping=!0,this.parameters=t.state.parameters,this.$nextTick(()=>{this.popping=!1}))},pushState(){if(!this.pushQuery||this.popping)return;const t=this.parameters,e=Object.keys(this.parameterMap),s=new URLSearchParams(Object.fromEntries(e.filter(i=>t.hasOwnProperty(i)).map(i=>[i,t[i]])));window.history.pushState({parameters:t},"","?"+s.toString())},autoApplyState(){if(!this.pushQuery||!window.location.search)return;const t=new URLSearchParams(window.location.search),e=Object.fromEntries(t.entries());this.popping=!0,this.parameters=e,this.$nextTick(()=>{this.popping=!1})}}},b=null,F=null;var S=o(C,b,F,!1,null,null,null,null);const w=S.exports,x={props:{sites:{type:Array,required:!0},value:{type:String,required:!0}},computed:{site(){return _.findWhere(this.sites,{handle:this.value})}}};var A=function(){var e=this,s=e._self._c;return s("v-select",{staticClass:"text-sm",attrs:{value:e.site,clearable:!1,searchable:!1,"get-option-label":i=>e.__(i.name),options:e.sites},on:{input:function(i){return e.$emit("input",i)}}})},k=[],q=o(x,A,k,!1,null,null,null,null);const p=q.exports,U={mixins:[w],components:{SiteSelector:p},props:{createFormUrl:{type:String,required:!0},initialFormConfigs:{type:Array,required:!0},initialLocalizations:{type:Array,required:!0},initialSite:{type:String,required:!0}},data(){return{rows:_.clone(this.initialFormConfigs),columns:[{label:__("Form"),field:"form"},{label:__("Audience ID"),field:"list_id"},{label:__("Tag"),field:"tag_id"}],localizations:_.clone(this.initialLocalizations),site:this.initialSite}},methods:{localizationSelected(t){t.active||(this.loading=!0,this.$axios.get(t.url).then(e=>{const s=e.data;this.rows=s.formConfigs,this.localizations=s.localizations,this.site=t.handle,this.loading=!1}))}}};var O=function(){var e=this,s=e._self._c;return s("div",[s("header",{staticClass:"mb-6"},[s("div",{staticClass:"flex items-center"},[s("h1",{staticClass:"flex-1"},[e._v("Mailchimp Pro")]),e.localizations.length>1?s("site-selector",{staticClass:"rtl:ml-4 ltr:mr-4",attrs:{sites:e.localizations,value:e.site},on:{input:e.localizationSelected}}):e._e(),s("a",{staticClass:"btn-primary",attrs:{href:e.createFormUrl},domProps:{textContent:e._s(e.__("Create Form"))}})],1)]),s("data-list",{attrs:{rows:e.rows,columns:e.columns}},[s("div",{staticClass:"card overflow-hidden p-0"},[s("data-list-table",{staticClass:"table-fixed",scopedSlots:e._u([{key:"cell-form",fn:function({row:i}){return[s("a",{attrs:{href:i.edit_url}},[e._v(e._s(i.title))])]}},{key:"actions",fn:function({row:i}){return[s("dropdown-list",[s("dropdown-item",{attrs:{text:e.__("Edit"),redirect:i.edit_url}})],1)]}}])})],1)])],1)},z=[],R=o(U,O,z,!1,null,null,null,null);const D=R.exports,E={components:{SiteSelector:p},props:{title:String,initialAction:String,initialDeleteUrl:String,initialListingUrl:String,blueprint:Object,initialMeta:Object,initialValues:Object,initialLocalizations:Array,initialSite:String},data(){return{localizing:!1,action:this.initialAction,deleteUrl:this.initialDeleteUrl,listingUrl:this.initialListingUrl,meta:_.clone(this.initialMeta),values:_.clone(this.initialValues),localizations:_.clone(this.initialLocalizations),site:this.initialSite,error:null,errors:{}}},computed:{isDirty(){return this.$dirty.has("base")}},methods:{clearErrors(){this.error=null,this.errors={}},save(){this.action&&(this.saving=!0,this.clearErrors(),this.$axios.patch(this.action,this.values).then(t=>{this.saving=!1,this.$toast.success(__("Saved")),this.$refs.container.saved(),this.$emit("saved",t)}).catch(t=>this.handleAxiosError(t)))},handleAxiosError(t){if(this.saving=!1,t.response&&t.response.status===422){const{message:e,errors:s}=t.response.data;this.error=e,this.errors=s,this.$toast.error(e)}else{const e=data_get(t,"response.data.message");this.$toast.error(e||t),console.log(t)}},localizationSelected(t){t.active||this.isDirty&&!confirm(__("Are you sure? Unsaved changes will be lost."))||(this.localizing=t.handle,window.history.replaceState({},"",t.url),this.$axios.get(t.url).then(e=>{const s=e.data;this.action=s.action,this.deleteUrl=s.deleteUrl,this.listingUrl=s.listingUrl,this.values=s.values,this.meta=s.meta,this.localizations=s.localizations,this.site=t.handle,this.localizing=!1,this.$nextTick(()=>this.$refs.container.clearDirtyState())}))}},created(){this.$keys.bindGlobal(["mod+s"],t=>{t.preventDefault(),this.save()})}};var T=function(){var e=this,s=e._self._c;return s("div",[s("header",{staticClass:"mb-6"},[s("div",{staticClass:"flex items-center"},[s("h1",{staticClass:"flex-1",domProps:{textContent:e._s(e.title)}}),e.deleteUrl?s("dropdown-list",{staticClass:"rtl:ml-2 ltr:mr-2"},[s("dropdown-item",{staticClass:"warning",attrs:{text:e.__("Delete Config")},on:{click:function(i){return e.$refs.deleter.confirm()}}},[s("resource-deleter",{ref:"deleter",attrs:{resourceTitle:e.title,route:e.deleteUrl,redirect:e.listingUrl}})],1)],1):e._e(),e.localizations.length>1?s("site-selector",{staticClass:"rtl:ml-4 ltr:mr-4",attrs:{sites:e.localizations,value:e.site},on:{input:e.localizationSelected}}):e._e(),s("button",{staticClass:"btn-primary min-w-100",domProps:{textContent:e._s(e.__("Save"))},on:{click:function(i){return i.preventDefault(),e.save.apply(null,arguments)}}})],1)]),s("publish-container",{ref:"container",attrs:{name:"base",blueprint:e.blueprint,meta:e.meta,errors:e.errors},scopedSlots:e._u([{key:"default",fn:function({setFieldValue:i,setFieldMeta:n}){return[s("publish-tabs",{on:{updated:i,"meta-updated":n}})]}}]),model:{value:e.values,callback:function(i){e.values=i},expression:"values"}})],1)},j=[],L=o(E,T,j,!1,null,null,null,null);const Q=L.exports,N={mixins:[Fieldtype],inject:["storeName"],data(){return{fields:[],selected:null,showFieldtype:!0}},watch:{list(t){this.showFieldtype=!1,this.refreshFields(),this.$nextTick(()=>this.showFieldtype=!0)}},computed:{formValues(){return this.$store.state.publish[this.storeName].values},list(){return data_get(this.formValues,"list_id.0")}},mounted(){this.selected=this.value,this.refreshFields()},methods:{refreshFields(){this.$axios.get(cp_url(`/mailchimp-pro/merge-fields/${this.list}`)).then(t=>{this.fields=t.data}).catch(()=>{this.fields=[]})}}};var V=function(){var e=this,s=e._self._c;return s("div",{staticClass:"mailchimp-pro-merge-fields-fieldtype-wrapper"},[e.list?e._e():s("small",{staticClass:"help-block text-grey-60"},[e._v(e._s(e.__("Select audience")))]),e.showFieldtype&&e.list?s("v-select",{attrs:{"append-to-body":"",clearable:!0,options:e.fields,reduce:i=>i.id,placeholder:e.__("Choose..."),searchable:!0},on:{input:function(i){return e.$emit("input",i)}},model:{value:e.selected,callback:function(i){e.selected=i},expression:"selected"}}):e._e()],1)},M=[],I=o(N,V,M,!1,null,null,null,null);const H=I.exports,K={mixins:[Fieldtype],inject:["storeName"],data(){return{tags:[],selected:null,showFieldtype:!0}},watch:{list(t){this.showFieldtype=!1,this.refreshTags(),this.$nextTick(()=>this.showFieldtype=!0)}},computed:{formValues(){return this.$store.state.publish[this.storeName].values},list(){return data_get(this.formValues,"list_id.0")}},mounted(){this.selected=this.value,this.refreshTags()},methods:{refreshTags(){this.$axios.get(cp_url(`/mailchimp-pro/tags/${this.list}`)).then(t=>{this.tags=t.data??[]}).catch(()=>{this.tags=[]})}}};var B=function(){var e=this,s=e._self._c;return s("div",{staticClass:"mailchimp-pro-tag-fieldtype-wrapper"},[e.list?e._e():s("small",{staticClass:"help-block text-grey-60"},[e._v(e._s(e.__("Select audience")))]),e.showFieldtype&&e.list?s("v-select",{attrs:{"append-to-body":"",clearable:!0,options:e.tags,reduce:i=>i.id,placeholder:e.__("Choose..."),searchable:!0},on:{input:function(i){return e.$emit("input",i)}},model:{value:e.selected,callback:function(i){e.selected=i},expression:"selected"}}):e._e()],1)},J=[],W=o(K,B,J,!1,null,null,null,null);const X=W.exports,G={mixins:[Fieldtype],inject:["storeName"],data(){return{fields:[],selected:null}},watch:{value:{immediate:!0,handler(t){this.selected=t}}},computed:{form(){return StatamicConfig.urlPath.split("/")[1]??""}},mounted(){this.refreshFields()},methods:{refreshFields(){this.$axios.get(cp_url(`/mailchimp-pro/form-fields/${this.form}`)).then(t=>{this.fields=t.data}).catch(()=>{this.fields=[]})}}};var Y=function(){var e=this,s=e._self._c;return s("div",{staticClass:"statamic-form-fields-fieldtype-wrapper"},[s("v-select",{attrs:{"append-to-body":"",clearable:!0,options:e.fields,reduce:i=>i.id,placeholder:e.__("Choose..."),searchable:!0},on:{input:function(i){return e.$emit("input",i)}},model:{value:e.selected,callback:function(i){e.selected=i},expression:"selected"}})],1)},Z=[],ee=o(G,Y,Z,!1,null,null,null,null);const te=ee.exports;Statamic.booting(()=>{Statamic.$components.register("mailchimp-listing",D),Statamic.$components.register("mailchimp-publish-form",Q),Statamic.$components.register("mailchimp_pro_merge_fields-fieldtype",H),Statamic.$components.register("mailchimp_pro_tag-fieldtype",X),Statamic.$components.register("statamic_form_fields-fieldtype",te)});
